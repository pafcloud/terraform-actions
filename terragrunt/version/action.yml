name: Select terragrunt version to use
description: Like tgenv - check path for .terragrunt-version file and use version specified there. Otherwise return default version.

inputs:
  working-directory:
    description: Path within repository
    required: true

outputs:
  version:
    description: Terragrunt version to use
    value: ${{ steps.main.outputs.version }}
  checksum:
    description: Terragrunt binary sha256 checksum
    value: ${{ steps.main.outputs.checksum }}

runs:
  using: composite
  steps: 
    - id: main
      run: |
        declare -A checksums=(
          ["0.27.1"]="b9f174e6613fe84121352ecdd238783504b642d390df87f8f8d760b42c44c02a"
          ["0.24.4"]="f65a22becc185af5291870b04653939cab0cee86beda97fd774feb6dc822b416"
        )

        version="0.24.4"
        if [ -f .terragrunt-version ]; then
          version=$(cat .terragrunt-version)
        fi

        echo ::set-output name=version::${version}
        echo ::set-output name=checksum::${checksums[$version]}
      shell: bash
      working-directory: ${{Â inputs.working-directory }}
